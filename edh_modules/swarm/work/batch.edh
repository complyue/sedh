#
# Swarm batch work manager
#

import * 'swarm/symbols'
import * 'swarm/headhunter'


export producer manageBatchJobs(
  params,  # generator or producer providing all ips
  # finished jobs and their respective ips is posted into this sink
  outlet,
) case HeadHunter(outlet) of { hh } -> {
  for (***ips) from params() do {
    # blocking wait the job dispatched
    hh.dispatchJob(ips)
  }
} @=> {  # tell the headhunter to stop anyway
  hh.allDone <- true
}

